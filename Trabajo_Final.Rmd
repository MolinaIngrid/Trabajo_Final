---
title: "Proyecto final"
author: "Ingrid MM"
date: "30/11/2020"
output: 
  prettydoc::html_pretty:
    theme: hpstr
    highlight: vignette
vignette: >
  %\VignetteIndexEntry{Creating Pretty Documents from R Markdown - The HPSTR Theme}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


### 1. ¿Cuál es la pregunta específica de investigación?

Identificar umbrales donde cambia la probabilidad de ocupación de especies de aves prioritarias  para la conservación, en relación con la complejidad estructural vegetal del paisaje.

Los datos para estimar la complejidad vegetal no los tendremos sino hasta enero 2021 por lo que para este ejercicio utilizaré información menos reciente de biomasa y cobertura. 

### 2. ¿Cuáles son las variables relevantes y cuál es su relación, conocida y/o hipotética? Para esta pregunta debe presentar al menos un DAG, a menos que la pregunta sea 100% descriptiva y no causal. 

La variable respuesta es la probabilidad de ocupación de las distintas especies de aves (ψ). 
La variable predictora es en este caso la Biomasa Vegetal sobre el suelo (BVSS) en radios de 30 y 100 m.
Otras covariables son el tipo de uso del suelo y el porcentaje de bosque.

### 3. ¿De dónde vienen los datos? Si son datos empíricos debe incluir el código para su procesamiento desde datos crudos, hasta datos analizables. 

Los datos vienen del trabajo de campo hecho desde finales de 2019 a Agosto 2020. Utilicé puntos de conteo de radio fijo y la aplicación ebird para anotar todas las especies detectadas en cada uno de los 160 puntos. Al bajar de la aplicación toda la información obtengo unas tablas muy grandes por eso debo procesar los datos

## Procesamiento de los datos:

A continueción todas las librerías que necesito pero antes me aseguro de tener los respectivos paquetes:

library(sf)

library(rnaturalearth)

library(lubridate)

library(tidyverse)

library(readr)

library(dplyr)

library(plyr)

library(tidyr)

library(readr)

library(unmarked)

library(MuMIn)

library(AICcmodavg)

```{r, include=FALSE}

library(sf)
library(rnaturalearth)
library(lubridate)
library(tidyverse)
library(readr)
library(dplyr)
library(plyr)
library(tidyr)
library(readr)
library(unmarked)
library(MuMIn)
library(AICcmodavg)

```

Ahora leemos todos los datos que tenemos de los puntos de conteo hechos en Costa Rica

```{r}
CRdatos_all <- read.csv("C:/Users/in/Documents/MAESTRIA/Cursos/Estrategias/Trabajo_Final/MyEBirdData.csv",stringsAsFactors=FALSE)
head(CRdatos_all)
dim(CRdatos_all)
#vemos que hay un total de 19,839 registros
names(CRdatos_all)

```

Revisando notamos que hay algunos errores en los nombres científicos entonces hay que corregirlos:

```{r}

Data.CR.2020.BPI.rsp <- CRdatos_all[!grepl("sp,", CRdatos_all[["Scientific.Name"]]), ]
Data.CR.2020.BPI.rsp <- Data.CR.2020.BPI.rsp[!grepl("sp.", Data.CR.2020.BPI.rsp[["Scientific.Name"]]), ]
Data.CR.2020.BPI.rsp <- Data.CR.2020.BPI.rsp[!grepl("sp ", Data.CR.2020.BPI.rsp[["Scientific.Name"]]), ]


Data.CR.2020.BPI.rsp$Scientific.Name[which(Data.CR.2020.BPI.rsp$Scientific.Name == "Ramphocelus passerinii passerinii")] <- "Ramphocelus costaricensis"
Data.CR.2020.BPI.rsp$Scientific.Name[which(Data.CR.2020.BPI.rsp$Scientific.Name == "Ramphocelus passerinii costaricensis")] <- "Ramphocelus costaricensis"
Data.CR.2020.BPI.rsp$Scientific.Name[which(Data.CR.2020.BPI.rsp$Scientific.Name == "Empidonax alnorum/traillii")] <- "Empidonax traillii"

Lista.especies.all <- unique(Data.CR.2020.BPI.rsp$Scientific.Name)
length(Lista.especies.all)

```

Verificamos que en Costa Rica hemos registrado un total de **218** especies distintas!

Posteriormente hacemos un subset de datos sólo con los puntos de conteo que establecimos mediante coordenadas. 


```{r}
Data.CR.2020.BPI <- Data.CR.2020.BPI.rsp[grepl("BPI-", Data.CR.2020.BPI.rsp[["Location"]]), ]
names(Data.CR.2020.BPI)
dim(Data.CR.2020.BPI)

Datos_fincas <- Data.CR.2020.BPI[,c("Location","Latitude","Longitude")]
Datos_BPI_CR <- distinct(Datos_fincas)
dim(Datos_BPI_CR)
head(Datos_fincas)

##acá hacemos un archivo csv para tener ese sub set de datos por separado:

write.csv(Datos_BPI_CR,"Datos_BPI_CR.csv", row.names = FALSE)
Datos_BPI_CR$Location

```


Luego separamos la fecha varias columnas para año, mes y día. Esto porque luego nos es más fácil seleccionar datos de un sólo mes, por ejemplo.
```{r}
Data.CR.2020.BPI <- Data.CR.2020.BPI %>% 
  dplyr::mutate(year = lubridate::year(Date), 
                month = lubridate::month(Date), 
                day = lubridate::day(Date),
                rec_1 = 1)
unique(Data.CR.2020.BPI$year)

dim(Data.CR.2020.BPI)
head(Data.CR.2020.BPI)

```



```{r}
Lista.especies.total <- unique(Data.CR.2020.BPI$Scientific.Name)
length(Lista.especies.total)

CR_bird_info <- read.delim("C:/Users/in/Documents/MAESTRIA/Cursos/Estrategias/Trabajo_Final/Lista_Costa_Rica.txt",stringsAsFactors=FALSE)
PIF_bird_info <- read.csv("C:/Users/in/Documents/MAESTRIA/Cursos/Estrategias/Trabajo_Final/CA_PIF_DataBase.csv",stringsAsFactors=FALSE)
PIF_bird_info.red <- PIF_bird_info[,c(3,5,6)]

```

4. Análisis de los datos. Se vale escoger un subconjunto de los datos para que esta sección sea concisa, pero debe ser un análisis coherente con el DAG del punto 2.

5. Interpretación breve de los resultados con respecto a la  pregunta de investigación y la hipótesis causal. Máximo un párrafo.


